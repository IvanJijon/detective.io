<form name="form"
      class="form-horizontal"
      ng-submit="submit(form)"
      novalidate>
    <div class="modal-header">
        <h3 class="modal-title">
            Add sources about <strong>[[ field_value ]]</strong>
        </h3>
    </div>
    <div class="modal-body">
        <!-- previously created sources -->
        <div class="form-group"
             ng-repeat="source in fields.field_sources | filter:isFieldSource">
            <div class='input-group'>
                <!-- source external link -->
                <span class="input-group-btn" ng-if="isSourceURLValid(source)">
                    <a target="_blank"
                       ng-click="$event.stopPropagation()"
                       ng-href="[[source.reference]]"
                       class="btn btn-default">
                        <i class="fa fa-external-link"></i>
                    </a>
                </span>
                <!-- source input -->
                <input type="text"
                       autocorrect="off"
                       autocapitalize="off"
                       focus-on="source.focus"
                       name="source[[$index]]"
                       no-duplicates="getSourcesRefs()"
                       ng-model="source.reference"
                       ng-blur="updateSource(source, form, $index, $event)"
                       ng-disabled="loading"
                       class="form-control"/>

                <!-- source delete button -->
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default delete-source-btn"
                        ng-click="deleteSource(source)">
                        <i class="fa fa-trash-o"></i>
                    </button>
                </span>
            </div>
            <!-- duplicate error handling -->
            <span class='text-danger' ng-if="form['source' + $index].$error.nodup">Source already exists, please enter another value</span>
        </div>
        <!-- new source form -->
        <div class='form-group'>
            <input type="text"
               name="new_source"
               autocorrect="off"
               autocapitalize="off"
               ng-change="addSource(new_source); new_source=undefined"
               focus-on="focus_add"
               ng-model="new_source"
               ng-disabled="loading"
               placeholder="http://exemple.com"
               class="form-control" />
        </div>
        <!-- scam to submit sources when 'ENTER' key is pressed -->
        <button class="hidden" type="submit">hidden</button>
    </div>
</form>
<div class="modal-footer" ng-class="{ loading: loading }">
    <button class="btn btn-primary"
            ng-click="save(form, true)">
        <strong>Save</strong>
    </button>
    <button class="btn btn-default" ng-click="cancel()">
        Cancel
    </button>
</div>