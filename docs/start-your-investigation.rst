========================
Start your investigation
========================

Detective.io is build around its ability to generate automaticly an API and a
front-end by parsing a given ontology. To write an ontology we use a very
strict syntax in JSON. This document aims to detail how to write this JSON.

.. _models:

Models
======

An ontolgy is composed of one or several models. Each model describes a family
of elements in your investigation. It can be a Person, an Organization, a
Country, etc. Every model has a list of *fields*, a *name* and optional *rules*
that allow a finer description of the model's behavior.

A minimal investigation with only one model looks something like this:

.. code-block:: json

    [
        {
            "name": "Person",
            "fields": [
                { "name": "name", "type": "string" },
                { "name": "birthday", "type": "date" }
            ]
        }
    ]

At the first level of our JSON we defined an array of model. This way we allow
the user to define the order of each model into the front-end.


.. _model-attributes:

Model attributes
----------------

This table gives a description of every model's attribute available.

.. list-table::
    :widths: 20 15 65
    :header-rows: 1

    * - Name
      - Type
      - Description

    * - description
      - string
      - Alias for *help_text*

    * - fields
      - array
      - The fields that compose your model. See :ref:`fields` section.

    * - help_text
      - string
      - The description of you model to help final user to understand what you
        are describing.

    * - name
      - string
      - The name of you model. This will be use to generate a slug to access the
        data related to your model. This will be converted to a normalized
        string, removing special characters and spaces.

    * - verbose_name
      - string
      - A human-readable name for your model. It is particulary
        accurate for name containing special characters or spaces.

    * - verbose_name_plural
      - string
      - The same as *verbose_name* but for plural elements. When not specified,
        this attribute is automaticly generated by adding a "s" to the end of
        the *verbose_name*.


.. _model-rules:

Model rules
-----------

Model rules are additional option that extend the default behavior of a model.
Unlike the model fields, those rules aren't build-in properties of the object
graph mapper.

.. code-block:: json

    [
        {
            "name": "Person",
            "fields": [],
            "rules": [
                {"is_editable": true},
                {"is_visible": false}
            ]
        }
    ]


This table gives a description of every model's rules available.

.. list-table::
    :widths: 20 15 65
    :header-rows: 1

    * - Name
      - Type
      - Description

    * - is_editable
      - boolean
      - Set to "false" if the user must not be able to edit this model's
        elements.

    * - is_searchable
      - boolean
      - Set to "false" if the user must not be able to search this element by
        name. **If the model doesn't have a *name* field, this will be set to
        false automaticly**.

    * - is_visible
      - boolean
      - Set to "false" if this model must not be visible in the contribute form.

.. _model-fields:

Model fields
------------

The model fields attribute is an array of fields.

.. code-block:: json

    [
        {
            "name": "Person",
            "help_text": "A Person represents a physical man or woman that is involved in an Organization, a Project or a Commentary.",
            "fields": [
                {
                    "name": "activity_in_organization",
                    "related_model": "Organization",
                    "type": "Relationship",
                    "verbose_name": "Activity in Organizations"
                },
                {
                    "name": "based_in",
                    "related_model": "Country",
                    "type": "Relationship",
                    "verbose_name": "Based in"
                },
                {
                    "name": "educated_in",
                    "related_model": "Country",
                    "type": "Relationship",
                    "verbose_name": "Educated in"
                },
                {
                    "help_text": "The URL (starting with http://) where the image is hosted.",
                    "name": "image",
                    "type": "URLField",
                    "verbose_name": "Image URL"
                },
                {
                    "name": "name",
                    "type": "CharField",
                    "verbose_name": "name"
                },
                {
                    "help_text": "Current position within the Organization (e.g. CEO, CFO, spokesperson etc.)",
                    "model": "Person",
                    "name": "position",
                    "type": "CharField",
                    "verbose_name": "Position"
                },
                {
                    "help_text": "Has the entity been active in a specific Organization previsously?",
                    "name": "previous_activity_in_organization",
                    "type": "Relationship",
                    "verbose_name": "Previous activity in"
                },
                {
                    "help_text": "The Twitter name of the entity (without the @)",
                    "name": "twitter_handle",
                    "type": "CharField",
                    "verbose_name": "Twitter handle"
                },
                {
                    "name": "website_url",
                    "type": "CharField",
                    "verbose_name": "Website URL"
                }
            ]
        }
    ]

.. _fields:

Fields
======

Each field is described using an object containing at least a *name* and a *type*.

.. _field-types:

Field types
-----------

.. list-table::
    :widths: 20 80
    :header-rows: 1

    * - Name
      - Description

    * - boolean
      - Two possible values: true or false. The default value is always false.

    * - datetime
      - Date value. Time aren't supported yet.

    * - float
      - Number allowing deicmal values. This type is not natively supported by
        our Object Graph Mapper yet. It is recorded as string and sanitize
        accordingly by the API.

    * - integer
      - Integer value.

    * - relationship
      - A relationship establishes a connection between to entities. This type
        has special attributes. See  :ref:`relationship-attributes`

    * - string
      - A sequence of characters.

    * - url
      - A URL string..


.. _field-rules:

Field attributes
----------------

A field can receive the following attributes.

.. list-table::
    :widths: 20 15 65
    :header-rows: 1

    * - Name
      - Type
      - Description

    * - default
      - mixed
      - Default value when no value is specified

    * - help_text
      - string
      - The description of you field to help final user to understand what you
        are describing with this field.

    * - indexed
      - boolean
      - If true, the server will take care of create an index for this field. It
        may help to improve performance. Default to true for name field.

    * - name
      - string
      - The name of your field. This will be converted to a normalized
        string, removing special characters and spaces. **This attribute is
        mandatory**.

    * - type
      - string
      - The type of your field. See :ref:`field-types`. **This attribute is
        mandatory**.

    * - verbose_name
      - string
      - A human-readable name for your field. It is particulary
        accurate for name containing special characters or spaces.


.. _relationship-attributes:

Relationship field attributes
-----------------------------

When the type of your field is "relationship", you have to specified some
special attributes.


.. list-table::
    :widths: 20 15 65
    :header-rows: 1

    * - Name
      - Type
      - Description

    * - related_model
      - string
      - The name of the mode to which the model is related. For relationship
        field, **this attribute is mandatory**.

    * - related_name
      - string
      - The name to use for the relation from the related object back to this
        one. When specified, this will create a reverse field automaticly into
        the *related_model*.

    * - fields
      - array
      - If you want to add some special attributes to this relationship. The
        given array will contain a list of fields following the
        same specification as any model field. However, relationship fields are
        not allowed.


.. _field-rules:

Field rules
-----------

Just like model, you can add some rules to your field.

.. code-block:: json

    [
        {
            "name": "Person",
            "fields": [
                {
                    "name": "name",
                    "type": "string",
                    "rules": [
                        {}
                    ]
                }
            ]
        }
    ]

This table gives a description of every fields's rules available.

.. list-table::
    :widths: 20 15 65
    :header-rows: 1

    * - Name
      - Type
      - Description

    * - has_properties
      - boolean
      - This rule specifies if a relationship has an intermediary model to
        describe it. This model is specified within the *through* attribute.

    * - is_editable
      - boolean
      - Set to "false" if the user must not be able to edit this field.

    * - is_rich
      - boolean
      - Set to "true" to unable rich text format for string field.

    * - is_searchable
      - boolean
      - This rules specifies if a relationship is bound to a searchable model or
        if every relationship is done with a brand new entity.

    * - is_visible
      - boolean
      - Set to "false" if this field must not be visible by default in the
        contribute form.

    * - through
      - string
      - This rule specifies the model used to describe a relationship.
